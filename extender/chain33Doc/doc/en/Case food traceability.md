# Case food traceability

[TOC]

## 1 Parallel Chain Environment Deployment

## 2 Contract Compiling
Use the Solidity compiler to compile contract, the following tools are available :

[Remix-ide](http://remix.ethereum.org)

[Intellij-Solidity](https://plugins.jetbrains.com/plugin/9475-intellij-solidity)

#### 2.1 Remix-ide

Create a new solidity contract, and select the compiler version to compile.

![remix_prepare](https://public.33.cn/web/storage/upload/20190226/23cc7ad57c6c3c5d76bc7b665e7114a2.png "remix_prepare")

Once compiled, the ABI and Bytecode can be used to create contracts.

![remix_compare](https://public.33.cn/web/storage/upload/20190226/6de5d85d0fb53a47930b742f41cd57c6.png "remix_compare")

* ABI generated by remix has characters such as newline, whitespace, etc. Chain33 EVM cannot use it directly, and further formatting is required: remove line breaks and whitespace.

* Chrome does not support copying compiled abi or bin file, so try to use Edge or Internet explorer.

Considering these two points, it is recommended to use Intellij-Solidity plug-ins for compilation.

NOTE： 
* When defining a struct in a contract：
* Do not define too many elements, or the compiler will declare exception Stack too deep.
* Do not use nested struct; currently the EVM virtual machine implemented internally by Chain33 does not support nested struct type.


#### 2.2 Intellij-Solidity

##### 2.2.1 Plug-In Installation
Open IntelliJ IDEA, in File->Settings->Plugins, find IntelliJ-Solidity to install。

![intelliJ_solidity](https://public.33.cn/web/storage/upload/20190226/4a61b115ef65e813c75c306e1f0209eb.png "intelliJ_solidity")

##### 2.2.2 Solc Installation

If no geth node is installed locally, you can get the official compiled version of Chain33 directly or use code to compile locally.
Otherwise you can use node build-in Solc directly.

###### 2.2.2.1 Native Compilation

Get the latest code to compile, github address: git@github.com:ethereum/solidity.git

Specific installation process refer to [Official Document ](https://solidity.readthedocs.io/en/latest/installing-solidity.html#building-from-source)

###### 2.2.2.2 Get the Compiled Version of Chain33

windows：
https://bty.oss-ap-southeast-1.aliyuncs.com/solc/solc_0.5.5-windows.zip

linux：
https://bty.oss-ap-southeast-1.aliyuncs.com/solc/solc_0.5.5-linux.tar.gz

macOS：
https://bty.oss-ap-southeast-1.aliyuncs.com/solc/solc_0.5.5-macOS.tar.gz

##### 2.2.3 Contract Compilation
Use Build->Compile Solidity to compile contract, the compiled results can be seen in the project bar.

![compile_solidity](https://public.33.cn/web/storage/upload/20190226/e286d4e377ffecd8271eec3ef4a36f4e.png "compile_solidity")

Use the generated abi, bin files for contract creation.

### 3 Contrct Creation
For details see [HERE](https://github.com/lynAzrael/L/blob/master/share/solidity/food_trace.md#3-%E5%90%88%E7%BA%A6%E7%9A%84%E5%88%9B%E5%BB%BA)

### 4 Case Implementation

To realize a food traceability process is to achieve the origin, production, circulation and other links of traceability.

The actual traceability is a very complicated process, which is reduced to the following steps: farm, food factory, supermarket, food quality inspection department, and user.
Properties of the product, take live pigs as an example.

#### 4.1 Information Input

##### 4.1.1 Add Pork Information
Cattle ranches selling

|Batch Number|Name|Weight|Date|Origin|
|----|----|----|----|----|
|00001|pig001|500|20190221|NanJing|

[Call Contract](https://github.com/lynAzrael/L/blob/master/share/solidity/food_trace.md#411-%E7%8C%AA%E8%82%89%E4%BF%A1%E6%81%AF%E5%BD%95%E5%85%A5)



##### 4.1.2 Add Food Information
Food factory production (for example, ham)

|Food number(such as QR code)|Name|Weight|Production Date|Packing Date|Expiration Date|Pork Batch|
|----|----|----|----|----|----|----|
|001|food001|500|20190215|20190220|20210215|00001|

[Call Contract](https://github.com/lynAzrael/L/blob/master/share/solidity/food_trace.md#412-%E9%A3%9F%E5%93%81%E4%BF%A1%E6%81%AF%E5%BD%95%E5%85%A5)

##### 4.1.3 Add Quality Control Information
Food quality inspection department sampling

|Food number(such as QR code)|Test Time|Test Results|Test Instructions
|----|----|----|----|
|food001|20190226|Qualified|The food is good.|

[Call Contract](https://github.com/lynAzrael/L/blob/master/share/solidity/food_trace.md#413-%E8%B4%A8%E6%A3%80%E4%BF%A1%E6%81%AF%E5%BD%95%E5%85%A5)

##### 4.1.4 Add Supermarket Shelf Information

|Food number(such as QR code)|Last Date|
|----|----|
|food001|20190304|

[Call Contract](https://github.com/lynAzrael/L/blob/master/share/solidity/food_trace.md#414-%E4%B8%8A%E6%9E%B6%E4%BF%A1%E6%81%AF%E5%BD%95%E5%85%A5)

##### 4.1.5 User Rating Update

|Food number(such as QR code)|User Rating|
|----|----|
|food001|90|

[Call Contract](https://github.com/lynAzrael/L/blob/master/share/solidity/food_trace.md#415-%E8%AF%84%E5%88%86%E4%BF%A1%E6%81%AF%E5%BD%95%E5%85%A5)

#### 4.2 Information Inquiry

##### 4.2.1 Pork Information Inquiry
[Call Contract](https://github.com/lynAzrael/L/blob/master/share/solidity/food_trace.md#423-%E7%81%AB%E8%85%BF%E5%8E%9F%E6%9D%90%E6%96%99%E7%8C%AA%E8%82%89%E4%BF%A1%E6%81%AF%E6%9F%A5%E8%AF%A2)

##### 4.2.2 Product Information Inquiry
[Call Contract](https://github.com/lynAzrael/L/blob/master/share/solidity/food_trace.md#421-%E7%81%AB%E8%85%BF%E4%BF%A1%E6%81%AF%E6%9F%A5%E8%AF%A2)

##### 4.2.3 Quality Testing Information Inquiry
[Call Contract](https://github.com/lynAzrael/L/blob/master/share/solidity/food_trace.md#422-%E8%B4%A8%E6%A3%80%E4%BF%A1%E6%81%AF%E6%9F%A5%E8%AF%A2)